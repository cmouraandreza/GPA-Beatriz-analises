perc = round(prop * 100, 1),
label = paste0(n_cat, " (", perc, "%)")
)
ggplot(df_plot, aes(x = grupo, y = prop, fill = categoria)) +
geom_col(width = 0.8) +
geom_text(
aes(label = label),
position = position_stack(vjust = 0.5),
size = 4,
color = "white",
fontface = "bold",
family = "Times New Roman"
) +
scale_y_continuous(labels = scales::percent_format()) +
scale_fill_brewer(palette = "Set2") +
labs(
title = titulo,      # <<< mesmo texto
x = NULL,
y = "Distribuição relativa (%)",
fill = titulo        # <<< mesmo texto
) +
theme_classic() +
theme(
plot.title = element_text(face = "bold", hjust = 0.5),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.grid = element_blank(),
panel.border = element_rect(color = "black", fill = NA),
panel.background = element_rect(fill = "white"),
legend.position = "right",
legend.title = element_text(face = "bold"),
axis.text.y = element_text(angle = 90, hjust = 0.5)
)+
scale_fill_brewer(palette = "Set3")
}
plot_atributo(dados_long, "BasArrSte","Basal arrangement of stem")
cores_suaves <- c(
"#c5283d", # verde água
"#FC8D62", # laranja suave
"#8DA0CB", # azul lavanda
"#E78AC3", # rosa
"#aeb4a9", # verde claro
"#f9c74f", # amarelo
"#E5C494"  # bege
)
cores_suaves <- c(
"#c5283d", # verde água
"#FC8D62", # laranja suave
"#8DA0CB", # azul lavanda
"#E78AC3", # rosa
"#aeb4a9", # verde claro
"#f9c74f", # amarelo
"#E5C494"  # bege
)
plot_atributo <- function(df, nome_atributo, titulo) {
df_plot <- df %>%
dplyr::filter(atributo == nome_atributo) %>%
dplyr::group_by(grupo, categoria) %>%
dplyr::summarise(n_cat = sum(n), .groups = "drop") %>%
dplyr::group_by(grupo) %>%
dplyr::mutate(
prop = n_cat / sum(n_cat),
perc = round(prop * 100, 1),
label = paste0(n_cat, " (", perc, "%)")
)
ggplot(df_plot, aes(x = grupo, y = prop, fill = categoria)) +
geom_col(width = 0.8) +
geom_text(
aes(label = label),
position = position_stack(vjust = 0.5),
size = 4,
color = "black",
fontface = "bold",
family = "Times New Roman"
) +
scale_y_continuous(labels = scales::percent_format()) +
scale_fill_brewer(palette = "Set2") +
labs(
title = titulo,      # <<< mesmo texto
x = NULL,
y = "Distribuição relativa (%)",
fill = titulo        # <<< mesmo texto
) +
theme_classic() +
theme(
plot.title = element_text(face = "bold", hjust = 0.5),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.grid = element_blank(),
panel.border = element_rect(color = "black", fill = NA),
panel.background = element_rect(fill = "white"),
legend.position = "right",
legend.title = element_text(face = "bold"),
axis.text.y = element_text(angle = 90, hjust = 0.5)
)+
scale_fill_manual(values = cores_suaves)
}
plot_atributo(dados_long, "BasArrSte","Basal arrangement of stem")
plot_atributo <- function(df, nome_atributo, titulo) {
df_plot <- df %>%
dplyr::filter(atributo == nome_atributo) %>%
dplyr::group_by(grupo, categoria) %>%
dplyr::summarise(n_cat = sum(n), .groups = "drop") %>%
dplyr::group_by(grupo) %>%
dplyr::mutate(
prop = n_cat / sum(n_cat),
perc = round(prop * 100, 1),
label = paste0(n_cat, " (", perc, "%)")
)
ggplot(df_plot, aes(x = grupo, y = prop, fill = categoria)) +
geom_col(width = 0.8) +
geom_text(
aes(label = label),
position = position_stack(vjust = 0.5),
size = 4,
color = "white",
fontface = "bold",
family = "Times New Roman"
) +
scale_y_continuous(labels = scales::percent_format()) +
scale_fill_brewer(palette = "Set2") +
labs(
title = titulo,      # <<< mesmo texto
x = NULL,
y = "Distribuição relativa (%)",
fill = titulo        # <<< mesmo texto
) +
theme_classic() +
theme(
plot.title = element_text(face = "bold", hjust = 0.5),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.grid = element_blank(),
panel.border = element_rect(color = "black", fill = NA),
panel.background = element_rect(fill = "white"),
legend.position = "right",
legend.title = element_text(face = "bold"),
axis.text.y = element_text(angle = 90, hjust = 0.5)
)+
scale_fill_manual(values = cores_suaves)
}
plot_atributo(dados_long, "BasArrSte","Basal arrangement of stem")
plot_atributo(dados_long, "TypGro", "Types of growth")
cores_suaves <- c(
"#FC8D62", # laranja suave
"#E5C494", # bege
"#8DA0CB", # azul lavanda
"#E78AC3", # rosa
"#aeb4a9", # verde claro
"#f9c74f", # amarelo
"#c5283d" # verde água
)
plot_atributo <- function(df, nome_atributo, titulo) {
df_plot <- df %>%
dplyr::filter(atributo == nome_atributo) %>%
dplyr::group_by(grupo, categoria) %>%
dplyr::summarise(n_cat = sum(n), .groups = "drop") %>%
dplyr::group_by(grupo) %>%
dplyr::mutate(
prop = n_cat / sum(n_cat),
perc = round(prop * 100, 1),
label = paste0(n_cat, " (", perc, "%)")
)
ggplot(df_plot, aes(x = grupo, y = prop, fill = categoria)) +
geom_col(width = 0.8) +
geom_text(
aes(label = label),
position = position_stack(vjust = 0.5),
size = 4,
color = "white",
fontface = "bold",
family = "Times New Roman"
) +
scale_y_continuous(labels = scales::percent_format()) +
scale_fill_brewer(palette = "Set2") +
labs(
title = titulo,      # <<< mesmo texto
x = NULL,
y = "Distribuição relativa (%)",
fill = titulo        # <<< mesmo texto
) +
theme_classic() +
theme(
plot.title = element_text(face = "bold", hjust = 0.5),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.grid = element_blank(),
panel.border = element_rect(color = "black", fill = NA),
panel.background = element_rect(fill = "white"),
legend.position = "right",
legend.title = element_text(face = "bold"),
axis.text.y = element_text(angle = 90, hjust = 0.5)
)+
scale_fill_manual(values = cores_suaves)
}
#criando os plots individuais
a<-plot_atributo(dados_long, "BasArrSte","Basal arrangement of stem")
a
b<-plot_atributo(dados_long, "TypGro", "Types of growth")
c<-plot_atributo(dados_long, "BraTyp", "Branching types")
d<-plot_atributo(dados_long, "HydExo", "Exoesqueleto do hidrante")
e<-plot_atributo(dados_long, "InsHyd", "Insertion of hydranth")
f<-plot_atributo(dados_long, "RimThe", "Rim of theca")
g<-plot_atributo(dados_long, "HydInsPat", "Hydrant insertion pattern")
h<-plot_atributo(dados_long, "Nem","Nematophore")
i<-plot_atributo(dados_long, "GonPro","Gonophore protection")
j<-plot_atributo(dados_long, "SexRep","Sexual reproduction")
k<-plot_atributo(dados_long, "MedLifCyc", "Medusa or medusoid in the life cycle")
l<-plot_atributo(dados_long, "Col","Coloniality")
ggsave("Plots/quadro1_distribuicao_relativa_color2.png",
plot = p, width = 12, height = 18, units = "in")
p<-(a+b)/(c+d)/ (e+f)/(g+h)/(i+j)+ (k+l)+
plot_layout(guides = "collect")
ggsave("Plots/quadro1_distribuicao_relativa_color2.png",
plot = p, width = 12, height = 18, units = "in")
plot_atributo <- function(df, nome_atributo, titulo) {
df_plot <- df %>%
dplyr::filter(atributo == nome_atributo) %>%
dplyr::group_by(grupo, categoria) %>%
dplyr::summarise(n_cat = sum(n), .groups = "drop") %>%
dplyr::group_by(grupo) %>%
dplyr::mutate(
prop = n_cat / sum(n_cat),
perc = round(prop * 100, 1),
label = paste0(n_cat, " (", perc, "%)")
)
ggplot(df_plot, aes(x = grupo, y = prop, fill = categoria)) +
geom_col(width = 0.8) +
geom_text(
aes(label = label),
position = position_stack(vjust = 0.5),
size = 4,
color = "#640d14",
fontface = "bold",
family = "Times New Roman"
) +
scale_y_continuous(labels = scales::percent_format()) +
scale_fill_brewer(palette = "Set2") +
labs(
title = titulo,      # <<< mesmo texto
x = NULL,
y = "Distribuição relativa (%)",
fill = titulo        # <<< mesmo texto
) +
theme_classic() +
theme(
plot.title = element_text(face = "bold", hjust = 0.5),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.grid = element_blank(),
panel.border = element_rect(color = "black", fill = NA),
panel.background = element_rect(fill = "white"),
legend.position = "right",
legend.title = element_text(face = "bold"),
axis.text.y = element_text(angle = 90, hjust = 0.5)
)+
scale_fill_manual(values = cores_suaves)
}
#criando os plots individuais
a<-plot_atributo(dados_long, "BasArrSte","Basal arrangement of stem")
1
a
#criando os plots individuais
a<-plot_atributo(dados_long, "BasArrSte","Basal arrangement of stem")
b<-plot_atributo(dados_long, "TypGro", "Types of growth")
c<-plot_atributo(dados_long, "BraTyp", "Branching types")
d<-plot_atributo(dados_long, "HydExo", "Exoesqueleto do hidrante")
e<-plot_atributo(dados_long, "InsHyd", "Insertion of hydranth")
f<-plot_atributo(dados_long, "RimThe", "Rim of theca")
g<-plot_atributo(dados_long, "HydInsPat", "Hydrant insertion pattern")
h<-plot_atributo(dados_long, "Nem","Nematophore")
i<-plot_atributo(dados_long, "GonPro","Gonophore protection")
j<-plot_atributo(dados_long, "SexRep","Sexual reproduction")
k<-plot_atributo(dados_long, "MedLifCyc", "Medusa or medusoid in the life cycle")
l<-plot_atributo(dados_long, "Col","Coloniality")
# plotando reprodução
p2<-(i+j)/(k+l)+
plot_layout(guides = "collect")
ggsave("Plots/distribuicao_relativa_reproducao.png",
plot = p2, width = 8, height = 12, units = "in")
ggsave("Plots/distribuicao_relativa_reproducao.png",
plot = p2, width = 12, height = 8, units = "in")
i<-plot_atributo(dados_long, "GonPro","Gonophore protection")+
annotate("text",x = -Inf, y = Inf, label = "(a)", hjust = -0.3,
vjust = 1.3,size = 5, fontface = "bold")
j<-plot_atributo(dados_long, "SexRep","Sexual reproduction")+
annotate("text",x = -Inf, y = Inf, label = "(b)", hjust = -0.3,
vjust = 1.3,size = 5, fontface = "bold")
k<-plot_atributo(dados_long, "MedLifCyc", "Medusa or medusoid in the life cycle")+
annotate("text",x = -Inf, y = Inf, label = "(c)", hjust = -0.3,
vjust = 1.3,size = 5, fontface = "bold")
l<-plot_atributo(dados_long, "Col","Coloniality")+
annotate("text",x = -Inf, y = Inf, label = "(d)", hjust = -0.3,
vjust = 1.3,size = 5, fontface = "bold")
# plotando reprodução
p2<-(i+j)/(k+l)+
plot_layout(guides = "collect")
p2
ggsave("Plots/distribuicao_relativa_reproducao.png",
plot = p2, width = 12, height = 8, units = "in")
# Criar df long para EPIBIONTE
dados_epi_long <- dados %>%
select(all_of(cols_epi)) %>%
pivot_longer(
cols = everything(),
names_to = "atributo",
values_to = "categoria"
) %>%
mutate(
grupo = "Epibiontes",
atributo = gsub("1$", "", atributo)
)
# Criar df long para BASIBIONTE
dados_base_long <- dados %>%
select(all_of(cols_base)) %>%
pivot_longer(
cols = everything(),
names_to = "atributo",
values_to = "categoria"
) %>%
mutate(
grupo = "Basibiontes",
atributo = gsub("2$", "", atributo)
)
# Unindo num df long
dados_long <- bind_rows(dados_epi_long, dados_base_long) %>%
filter(!is.na(categoria), categoria != "")
# Limpar prefixos B- e E-
dados_long <- dados_long %>%
mutate(
categoria = gsub("^[BE]-", "", categoria)
)
# AGORA CONTA AS OCORRÊNCIAS
dados_long <- dados_long %>%
group_by(grupo, atributo, categoria) %>%
summarise(n = n(), .groups = "drop")
# Verificar atributos únicos
unique(dados_long$atributo)
plot_atributo <- function(df, nome_atributo, titulo_grafico, titulo_legenda) {
df_plot <- df %>%
dplyr::filter(atributo == nome_atributo) %>%
dplyr::group_by(grupo, categoria) %>%
dplyr::summarise(n_cat = sum(n), .groups = "drop") %>%
dplyr::group_by(grupo) %>%
dplyr::mutate(
prop = n_cat / sum(n_cat),
perc = round(prop * 100, 1),
label = paste0(n_cat, " (", perc, "%)")
)
ggplot(df_plot, aes(x = grupo, y = prop, fill = categoria)) +
geom_col(width = 0.8) +
geom_text(
aes(label = label),
position = position_stack(vjust = 0.5),
size = 4,
color = "white",
fontface = "bold",
family = "Times New Roman"
) +
scale_y_continuous(labels = scales::percent_format()) +
scale_fill_brewer(palette = "Set2") +
labs(
title = titulo_grafico,          # <<< TÍTULO DO GRÁFICO
x = NULL,
y = "Distribuição relativa (%)",
fill = titulo_legenda
) +
theme_classic() +
theme(
plot.title = element_text(face = "bold", hjust = 0.5), # centralizado
axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.grid = element_blank(),
panel.border = element_rect(color = "black", fill = NA),
panel.background = element_rect(fill = "white"),
legend.position = "left",
legend.title = element_text(face = "bold"),
axis.text.y = element_text(angle = 90, hjust = 0.5)
)
}
cores_suaves <- c(
"#FC8D62", # laranja suave
"#E5C494", # bege
"#8DA0CB", # azul lavanda
"#E78AC3", # rosa
"#aeb4a9", # verde claro
"#f9c74f", # amarelo
"#c5283d" # verde água
)
plot_atributo <- function(df, nome_atributo, titulo) {
df_plot <- df %>%
dplyr::filter(atributo == nome_atributo) %>%
dplyr::group_by(grupo, categoria) %>%
dplyr::summarise(n_cat = sum(n), .groups = "drop") %>%
dplyr::group_by(grupo) %>%
dplyr::mutate(
prop = n_cat / sum(n_cat),
perc = round(prop * 100, 1),
label = paste0(n_cat, " (", perc, "%)")
)
ggplot(df_plot, aes(x = grupo, y = prop, fill = categoria)) +
geom_col(width = 0.8) +
geom_text(
aes(label = label),
position = position_stack(vjust = 0.5),
size = 4,
color = "#640d14",
fontface = "bold",
family = "Times New Roman"
) +
scale_y_continuous(labels = scales::percent_format()) +
scale_fill_brewer(palette = "Set2") +
labs(
title = titulo,      # <<< mesmo texto
x = NULL,
y = "Distribuição relativa (%)",
fill = titulo        # <<< mesmo texto
) +
theme_classic() +
theme(
plot.title = element_text(face = "bold", hjust = 0.5),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.grid = element_blank(),
panel.border = element_rect(color = "black", fill = NA),
panel.background = element_rect(fill = "white"),
legend.position = "right",
legend.title = element_text(face = "bold"),
axis.text.y = element_text(angle = 90, hjust = 0.5)
)+
scale_fill_manual(values = cores_suaves)
}
a<-plot_atributo(dados_long, "BasArrSte","Basal arrangement of stem")
b<-plot_atributo(dados_long, "TypGro", "Types of growth")
c<-plot_atributo(dados_long, "BraTyp", "Branching types")
d<-plot_atributo(dados_long, "HydExo", "Exoesqueleto do hidrante")
e<-plot_atributo(dados_long, "InsHyd", "Insertion of hydranth")
f<-plot_atributo(dados_long, "RimThe", "Rim of theca")
g<-plot_atributo(dados_long, "HydInsPat", "Hydrant insertion pattern")
h<-plot_atributo(dados_long, "Nem","Nematophore")
i<-plot_atributo(dados_long, "GonPro","Gonophore protection")+
annotate("text",x = -Inf, y = Inf, label = "(a)", hjust = -0.3,
vjust = 1.3,size = 5, fontface = "bold")
j<-plot_atributo(dados_long, "SexRep","Sexual reproduction")+
annotate("text",x = -Inf, y = Inf, label = "(b)", hjust = -0.3,
vjust = 1.3,size = 5, fontface = "bold")
k<-plot_atributo(dados_long, "MedLifCyc", "Medusa or medusoid in the life cycle")+
annotate("text",x = -Inf, y = Inf, label = "(c)", hjust = -0.3,
vjust = 1.3,size = 5, fontface = "bold")
l<-plot_atributo(dados_long, "Col","Coloniality")+
annotate("text",x = -Inf, y = Inf, label = "(d)", hjust = -0.3,
vjust = 1.3,size = 5, fontface = "bold")
# plotando reprodução separado ----
p2<-(i+j)/(k+l)+
plot_layout(guides = "collect")
p2
ggsave("Plots/distribuicao_relativa_reproducao.png",
plot = p2, width = 12, height = 8, units = "in")
#criando os plots individuais
a<-plot_atributo(dados_long, "BasArrSte","Basal arrangement of stem")+
annotate("text",x = -Inf, y = Inf, label = "(a)", hjust = -0.3,
vjust = 1.3,size = 5, fontface = "bold")
b<-plot_atributo(dados_long, "TypGro", "Types of growth")+
annotate("text",x = -Inf, y = Inf, label = "(b)", hjust = -0.3,
vjust = 1.3,size = 5, fontface = "bold")
c<-plot_atributo(dados_long, "BraTyp", "Branching types")+
annotate("text",x = -Inf, y = Inf, label = "(c)", hjust = -0.3,
vjust = 1.3,size = 5, fontface = "bold")
d<-plot_atributo(dados_long, "HydExo", "Exoesqueleto do hidrante")+
annotate("text",x = -Inf, y = Inf, label = "(d)", hjust = -0.3,
vjust = 1.3,size = 5, fontface = "bold")
perissarco<-(a+b)/(c+d)+
plot_layout(guides = "collect")
ggsave("Plots/distribuicao_relativa_perissarco.png",
plot = perissarco, width = 12, height = 8, units = "in")
ggsave("Plots/Defesa/distribuicao_relativa_perissarco.png",
plot = perissarco, width = 12, height = 8, units = "in")
d<-plot_atributo(dados_long, "HydExo", "Hydranth exoskeleton")+
annotate("text",x = -Inf, y = Inf, label = "(d)", hjust = -0.3,
vjust = 1.3,size = 5, fontface = "bold")
perissarco<-(a+b)/(c+d)+
plot_layout(guides = "collect")
ggsave("Plots/Defesa/distribuicao_relativa_perissarco.png",
plot = perissarco, width = 12, height = 8, units = "in")
d<-plot_atributo(dados_long, "HydInsPat", "Hydrant insertion pattern")+
annotate("text",x = -Inf, y = Inf, label = "(d)", hjust = -0.3,
vjust = 1.3,size = 5, fontface = "bold")
perissarco<-(a+b)/(c+d)+
plot_layout(guides = "collect")
ggsave("Plots/Defesa/distribuicao_relativa_perissarco.png",
plot = perissarco, width = 12, height = 8, units = "in")
#figura da hidroteca e nemato----
e<-plot_atributo(dados_long, "InsHyd", "Insertion of hydranth")+
annotate("text",x = -Inf, y = Inf, label = "(a)", hjust = -0.3,
vjust = 1.3,size = 5, fontface = "bold")
f<-plot_atributo(dados_long, "RimThe", "Rim of theca")+
annotate("text",x = -Inf, y = Inf, label = "(b)", hjust = -0.3,
vjust = 1.3,size = 5, fontface = "bold")
g<-plot_atributo(dados_long, "HydExo", "Hydranth exoskeleton")+
annotate("text",x = -Inf, y = Inf, label = "(c)", hjust = -0.3,
vjust = 1.3,size = 5, fontface = "bold")
h<-plot_atributo(dados_long, "Nem","Nematophore")+
annotate("text",x = -Inf, y = Inf, label = "(d)", hjust = -0.3,
vjust = 1.3,size = 5, fontface = "bold")
hidroteca_nemato<-(e+f)/(g+h)+
plot_layout(guides = "collect")
ggsave("Plots/Defesa/hidroteca_nemato.png",
plot = perissarco, width = 12, height = 8, units = "in")
ggsave("Plots/Defesa/distribuicao_relativa_hidroteca_nemato.png",
plot = perissarco, width = 12, height = 8, units = "in")
ggsave("Plots/Defesa/distribuicao_relativa_hidroteca_nemato.png",
plot = hidroteca_nemato, width = 12, height = 8, units = "in")
