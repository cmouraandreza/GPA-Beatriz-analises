fill = Genera,
label = paste0(Genera, "\n", abs(n), " (", round(abs(percentual), 1), "%)")
)) +
geom_treemap(color = "white") +
geom_treemap_text(
place = "centre", grow = TRUE, reflow = TRUE,
color = "white", fontface = "bold", size = 10
) +
scale_fill_manual(values = palette_fam) +
labs(title = "Basebiontes") +
theme_minimal() +
theme(legend.position = "none")
#3Ô∏è‚É£ Juntar os dois:
plots_tree<- g_epi + g_base + plot_layout(ncol = 2)
plots_tree
# Basebiontes‚úîÔ∏è
g_base <- ggplot(df_base, aes(
area = abs(n),
fill = Genera,
label = paste0(Genera, "\n", abs(n), " (", round(abs(percentual), 1), "%)")
)) +
geom_treemap(color = "white") +
geom_treemap_text(
place = "centre", grow = TRUE, reflow = TRUE,
color = "white", fontface = "bold", size = 10
) +
scale_fill_manual(values = palette_gen) +
labs(title = "Basebiontes") +
theme_minimal() +
theme(legend.position = "none")
#3Ô∏è‚É£ Juntar os dois:
plots_tree<- g_epi + g_base + plot_layout(ncol = 2)
plots_tree
# Basebiontes‚úîÔ∏è
g_base <- ggplot(df_base, aes(
area = abs(n),
fill = Genera,
label = paste0(Genera, "\n", abs(n), " (", round(abs(percentual), 1), "%)")
)) +
geom_treemap(color = "white") +
geom_treemap_text(
place = "centre", grow = TRUE, reflow = TRUE,
color = "white", fontface = "bold", size = 10
) +
scale_fill_manual(values = palette_gen) +
labs(title = "Basibiontes") +
theme_minimal() +
theme(legend.position = "none")
#3Ô∏è‚É£ Juntar os dois:
plots_tree<- g_epi + g_base + plot_layout(ncol = 2)
plots_tree
df_long <- df_long %>%
mutate(n_abs = abs(n)) %>%
group_by(grupo) %>%
mutate(
total_grupo = sum(n_abs, na.rm = TRUE),
percentual = 100 * n_abs / total_grupo
) %>%
ungroup()
# Separar os dados‚úîÔ∏è
df_epi <- df_long %>% filter(grupo == "Epibiontes", abs(percentual) >= 1.5)
df_base <- df_long %>% filter(grupo == "Basebiontes", abs(percentual) >= 1.5)
# 2Ô∏è‚É£ Gerar os treemaps com fill = family e scale_fill_manual(values = palette_fam)
# Epibiontes‚úîÔ∏è
g_epi <- ggplot(df_epi, aes(
area = abs(n),
fill = Genera,
label = paste0(Genera, "\n", abs(n), " (", round(abs(percentual), 1), "%)")
)) +
geom_treemap(color = "white") +
geom_treemap_text(
place = "centre", grow = TRUE, reflow = TRUE,
color = "white", fontface = "bold", size = 10
) +
scale_fill_manual(values = palette_gen) +
labs(title = "Epibiontes") +
theme_minimal() +
theme(legend.position = "none")
# Basebiontes‚úîÔ∏è
g_base <- ggplot(df_base, aes(
area = abs(n),
fill = Genera,
label = paste0(Genera, "\n", abs(n), " (", round(abs(percentual), 1), "%)")
)) +
geom_treemap(color = "white") +
geom_treemap_text(
place = "centre", grow = TRUE, reflow = TRUE,
color = "white", fontface = "bold", size = 10
) +
scale_fill_manual(values = palette_gen) +
labs(title = "Basibiontes") +
theme_minimal() +
theme(legend.position = "none")
#3Ô∏è‚É£ Juntar os dois:
plots_tree<- g_epi + g_base + plot_layout(ncol = 2)
plots_tree
View(df_long)
View(df_epi)
View(g_epi)
View(g_epi)
df_long <- df_long %>%
mutate(n_abs = abs(n)) %>%
group_by(grupo) %>%
mutate(
total_grupo = sum(n_abs, na.rm = TRUE),
percentual = 100 * n_abs / total_grupo
) %>%
ungroup()
View(df_long)
df_long_corrigido <- df_long %>%
mutate(
n_abs = abs(n)   # garante valor absoluto
) %>%
group_by(grupo) %>%
mutate(
total_grupo = sum(n_abs, na.rm = TRUE),
percentual = 100 * n_abs / total_grupo
) %>%
ungroup()
View(df_long_corrigido)
df_long_corrigido %>%
group_by(grupo) %>%
summarise(
total_registros = sum(n_abs),
soma_percentual = sum(percentual)
)
View(df)
count(df$n_epi)
sum(df$n_epi)
sum(df$n_base)
# ‚úîÔ∏èSALVANDO‚úîÔ∏è
ggsave("Plots/treemap_generos-contagem.png",
plot = plots_tree, width = 14, height = 8, dpi = 600, units = "in")
# remove NA
df_int <- df1 %>%
dplyr::select(Scientific_name_EP, BS_Family) %>%
filter(!is.na(Scientific_name_EP), !is.na(BS_Family))
# tabela de conting√™ncia
tab <- table(df_int$Scientific_name_EP, df_int$BS_Family)
tab
chisq.test(tab)
tab <- table(df1$Scientific_name_EP, df1$BS_Family)
chisq.test(tab)
fisher.test(tab)
#1) Contar epibiontes por fam√≠lia de basibionte (Top N por fam√≠lia)
library(dplyr)
topN <- 20  # coloque 20 se quiser
epi_por_familia <- df1 %>%
filter(!is.na(Scientific_name_EP), !is.na(BS_Family)) %>%
count(BS_Family, Scientific_name_EP, name = "n_ocorrencias") %>%
group_by(BS_Family) %>%
arrange(desc(n_ocorrencias), .by_group = TRUE) %>%
slice_head(n = topN) %>%
ungroup() %>%
rename(
basibionte_family = BS_Family,
epibionte_species = Scientific_name_EP
)
epi_por_familia
View(epi_por_familia)
#2) Percentual dentro de cada fam√≠lia (fica lindo pro Excel)
epi_por_familia_pct <- df1 %>%
filter(!is.na(Scientific_name_EP), !is.na(BS_Family)) %>%
count(BS_Family, Scientific_name_EP, name = "n_ocorrencias") %>%
group_by(BS_Family) %>%
mutate(
total_familia = sum(n_ocorrencias),
percentual_na_familia = 100 * n_ocorrencias / total_familia
) %>%
arrange(desc(n_ocorrencias), .by_group = TRUE) %>%
ungroup() %>%
rename(
basibionte_family = BS_Family,
epibionte_species = Scientific_name_EP
)
epi_por_familia_pct
#4) (Opcional) Gr√°fico r√°pido (top epibiontes por fam√≠lia)
library(ggplot2)
epi_por_familia %>%
ggplot(aes(x = n_ocorrencias, y = reorder(epibionte_species, n_ocorrencias))) +
geom_col() +
facet_wrap(~ basibionte_family, scales = "free_y") +
labs(x = "N¬∫ de ocorr√™ncias", y = "Esp√©cie epibionte") +
theme_minimal() +
theme(axis.text.y = element_text(face = "italic"))
#3) Exportar pra Excel
library(writexl)
write_xlsx(
list(
"Top_epibiontes_por_familia" = epi_por_familia,
"Epibiontes_por_familia_pct" = epi_por_familia_pct
),
"Tabelas/epibiontes_por_familia_basibionte.xlsx"
)
write_xlsx(
list(
"Top_epibiontes_por_familia" = epi_por_familia,
"Epibiontes_por_familia_pct" = epi_por_familia_pct
),
"epibiontes_por_familia_basibionte.xlsx"
)
auto_sp <- df1 %>%
filter(!is.na(Scientific_name_EP),
!is.na(Scientific_name_BS)) %>%
filter(Scientific_name_EP == Scientific_name_BS)
auto_sp
View(auto_sp)
# em genero
dfgen <- df1 %>%
mutate(
EP_genus = word(Scientific_name_EP, 1),
BS_genus = word(Scientific_name_BS, 1)
)
# em genero
dfgen <- df1 %>%
mutate(
EP_genus = word(Scientific_name_EP, 1),
BS_genus = word(Scientific_name_BS, 1)
)
auto_genus <- dfgen %>%
filter(!is.na(EP_genus), !is.na(BS_genus)) %>%
filter(EP_genus == BS_genus,
Scientific_name_EP != Scientific_name_BS)
auto_genus
View(auto_genus)
View(df)
View(df1)
select(auto_genus, "ID", "EP_genus","BS_genus","Scientific_name_EP","Scientific_name_BS")
dplyr::select(auto_genus, "ID", "EP_genus","BS_genus","Scientific_name_EP","Scientific_name_BS")
genus<-dplyr::select(auto_genus, "ID", "EP_genus","BS_genus","Scientific_name_EP","Scientific_name_BS")
genus
write_xlsx(
list(
"Top_epibiontes_por_familia" = epi_por_familia,
"Epibiontes_por_familia_pct" = epi_por_familia_pct,
"Generos_autoepibiose" = genus
),
"epibiontes_por_familia_basibionte.xlsx"
)
# em familia
auto_family <- df1 %>%
filter(!is.na(EP_family), !is.na(BS_Family)) %>%
filter(EP_family == BS_Family)
auto_family
family<-dplyr::select(auto_family, "ID", "EP_family ","BS_family ","Scientific_name_EP","Scientific_name_BS")
View(auto_family)
colnames(auto_family)
family<-dplyr::select(auto_family, "ID", "EP_family ","BS_family ","Scientific_name_EP","Scientific_name_BS")
family<-dplyr::select(auto_family, "ID", "EP_family","BS_family ","Scientific_name_EP","Scientific_name_BS")
family<-dplyr::select(auto_family, "ID", "EP_family","BS_family","Scientific_name_EP","Scientific_name_BS")
colnames(auto_family)
family<-dplyr::select(auto_family, "ID", "EP_family","BS_Family","Scientific_name_EP","Scientific_name_BS")
write_xlsx(
list(
"Top_epibiontes_por_familia" = epi_por_familia,
"Epibiontes_por_familia_pct" = epi_por_familia_pct,
"Generos_autoepibiose" = genus,
"Familias_autoepibiose" =family
),
"epibiontes_por_familia_basibionte.xlsx"
)
auto_family <- df1 %>%
filter(!is.na(EP_family), !is.na(BS_Family)) %>%
filter(EP_family == BS_Family)
auto_family
View(auto_family)
epi_por_familia %>%
ggplot(aes(x = n_ocorrencias, y = reorder(epibionte_species, n_ocorrencias))) +
geom_col() +
facet_wrap(~ basibionte_family, scales = "free_y") +
labs(x = "N¬∫ de ocorr√™ncias", y = "Esp√©cie epibionte") +
theme_minimal() +
theme(axis.text.y = element_text(face = "italic"))
epi_por_familia
epi_por_familia_pct <- df1 %>%
filter(!is.na(Scientific_name_EP), !is.na(BS_Family)) %>%
count(BS_Family, Scientific_name_EP, name = "n_ocorrencias") %>%
group_by(BS_Family) %>%
mutate(
total_familia = sum(n_ocorrencias),
percentual_na_familia = 100 * n_ocorrencias / total_familia
) %>%
ungroup() %>%
rename(
basibionte_family = BS_Family,
epibionte_species = Scientific_name_EP
)
View(epi_por_familia_pct)
n_distinct(epi_por_familia_pct$basibionte_family)
n_distinct(epi_por_familia$basibionte_family)
intersect(overlap_species, epi)
epi_exclusivas <- setdiff(epi, overlap_species)
df1<- readxl::read_xlsx("Data/COPIA-Database_epizoism_hydroids-bea.xlsx")
colnames(df1
)
"Scientific_name_EP",  "Scientific_name_BS"
# dist√¢ncia de Jaccard (0 = igual, 1 = totalmente diferente)
dist_jaccard <- vegdist(mat, method = "jaccard", binary = TRUE)
dist_jaccard
# se quiser a similaridade (1 - dist√¢ncia)
sim_jaccard <- 1 - as.numeric(dist_jaccard)
sim_jaccard
# ver  quanto da de overlap
overlap <- length(intersect(epi, base)) / length(union(epi, base))
df1<- readxl::read_xlsx("Data/COPIA-Database_epizoism_hydroids-bea.xlsx")
colnames(df1
)
"Scientific_name_EP",  "Scientific_name_BS"
library(vegan)
df2<-dplyr::select(df1,"Scientific_name_EP", "Scientific_name_BS")
library(vegan)
# listas √∫nicas
epi <- unique(df1$Scientific_name_EP)
base <- unique(df1$Scientific_name_BS)
# remove NAs
as.data.frame(epi <- epi[!is.na(epi)])
as.data.frame(base <- base[!is.na(base)])
# universo de esp√©cies
sp_all <- sort(unique(c(epi, base)))
# ver  quanto da de overlap
overlap <- length(intersect(epi, base)) / length(union(epi, base))
overlap
#quero ver quais esp√©cies est√£o fazendo o overlap
# esp√©cies que aparecem nos dois pap√©is
overlap_species <- intersect(epi, base)
# visualizar
as.data.frame(overlap_species)
epi_exclusivas <- setdiff(epi, overlap_species)
epi_exclusivas
epi_exclusivas <-as.data.frame( setdiff(epi, overlap_species))
epi_exclusivas
base_exclusivas <- as.data.frame(setdiff(base, overlap_species))
base_exclusivas
df1<- readxl::read_xlsx("Data/COPIA-Database_epizoism_hydroids-bea.xlsx")#‚úîÔ∏è
### FAMILIAS ------
familias_epi_spp <- df1 %>%
distinct(EP_family, Scientific_name_EP) %>%  # remove duplicatas de esp√©cie dentro da fam√≠lia
count(EP_family, name = "n_epi") %>%    # conta quantas esp√©cies √∫nicas por fam√≠lia
arrange(desc(n_epi))%>%
rename(family = EP_family)  # se j√° for EP_family, use rename(family = EP_family)
familias_base_spp <- df1 %>%
distinct(BS_Family, Scientific_name_EP) %>%  # remove duplicatas de esp√©cie dentro da fam√≠lia
count(BS_Family, name = "n_base") %>%    # conta quantas esp√©cies √∫nicas por fam√≠lia
arrange(desc(n_base))%>%
rename(family = BS_Family)
df <- full_join(familias_base_spp, familias_epi_spp, by = "family") %>%
mutate(across(c(n_epi, n_base), ~replace_na(.x, 0)))
# (opcional) ordenar por total absoluto
df <- df %>%
mutate(total = n_epi + n_base,
family = fct_reorder(family, total, .desc = TRUE))
df <- full_join(familias_base_spp, familias_epi_spp, by = "family") %>%
mutate(across(c(n_epi, n_base), ~replace_na(.x, 0)))
# (opcional) ordenar por total absoluto
df <- df %>%
mutate(total = n_epi + n_base,
family = fct_reorder(family, total, .desc = TRUE))
# --- 2) Long + sinal negativo para basebiontes ---
df_long <- df %>%
pivot_longer(c(n_epi, n_base), names_to = "grupo", values_to = "n") %>%
mutate(
grupo = recode(grupo, n_epi = "Epibiontes", n_base = "Basebiontes"),
n = if_else(grupo == "Basebiontes", -n, n)
)
df_long <- df_long %>%
group_by(grupo) %>%
mutate(
total_abs = sum(abs(n), na.rm = TRUE),
percentual = 100 * n / total_abs
) %>%
ungroup()
#install.packages("treemapify")
library(treemapify)
library(ggplot2)
library(patchwork)
library(RColorBrewer)
# todas as fam√≠lias envolvidas‚úîÔ∏è
Species_unicas <- unique(df_long$family)
# gerar paleta (pode ajustar n de cores conforme necess√°rio)
palette_fam <- setNames(
colorRampPalette(brewer.pal(9, "Set1"))(length(Species_unicas)),
Species_unicas
)
# Separar os dados‚úîÔ∏è
df_epi <- df_long %>% filter(grupo == "Epibiontes", abs(percentual) >= 1.5)
df_base <- df_long %>% filter(grupo == "Basebiontes", abs(percentual) >= 1.5)
#1Ô∏è‚É£ Contagem absoluta esp√©cie √ó fam√≠lia
library(dplyr)
library(tidyr)
tab_epi_fam <- df1 %>%
filter(!is.na(Scientific_name_EP), !is.na(BS_Family)) %>%
count(Scientific_name_EP, BS_Family, name = "n")
tab_epi_fam
#2Ô∏è‚É£ Transformar em matriz (wide)
mat_epi_fam <- tab_epi_fam %>%
pivot_wider(
names_from = BS_Family,
values_from = n,
values_fill = 0
)
View(mat_epi_fam)
mat_ca <- mat_epi_fam %>%
column_to_rownames("Scientific_name_EP") %>%
select(-total) %>%     # remove a coluna total, se existir
as.matrix()
mat_ca
mat_epi_fam
mat_ca <- tab_epi_fam %>%
column_to_rownames("Scientific_name_EP") %>%
select(-total) %>%     # remove a coluna total, se existir
as.matrix()
tab_epi_fam
mat_ca <- mat_epi_fam %>%
column_to_rownames("Scientific_name_EP") %>%
as.matrix()
mat_ca
library(vegan)
ca_res <- cca(mat_ca)
summary(ca_res)
plot(ca_res, scaling = 2)
#üé® 6Ô∏è‚É£ Gr√°fico bonito com ggplot (recomendado)
library(ggplot2)
scores_sp <- scores(ca_res, display = "species", scaling = 2) %>%
as.data.frame() %>%
rownames_to_column("Species")
scores_fam <- scores(ca_res, display = "sites", scaling = 2) %>%
as.data.frame() %>%
rownames_to_column("Family")
ggplot() +
geom_point(data = scores_sp,
aes(x = CA1, y = CA2),
color = "steelblue", size = 2) +
geom_text(data = scores_sp,
aes(x = CA1, y = CA2, label = Species),
size = 3, fontface = "italic", hjust = 0.5) +
geom_point(data = scores_fam,
aes(x = CA1, y = CA2),
color = "firebrick", size = 3) +
geom_text(data = scores_fam,
aes(x = CA1, y = CA2, label = Family),
size = 3.5, fontface = "bold") +
theme_minimal() +
labs(
title = "Correspondence Analysis (CA)",
x = "CA1",
y = "CA2"
)
#testanto outra coisa
library(dplyr)
edges <- df1 %>%
filter(!is.na(Scientific_name_EP), !is.na(BS_Family)) %>%
count(Scientific_name_EP, BS_Family, name = "weight") %>%
rename(
epibionte = Scientific_name_EP,
basifamily = BS_Family
)
min_w <- 3
edges_f <- edges %>% filter(weight >= min_w)
library(igraph)
library(ggraph)
library(ggraph)
install.packages("ggraph")
#install.packages("ggraph")
library(ggraph)
library(tidygraph)
# criar n√≥s
nodes <- tibble::tibble(
name = unique(c(edges_f$epibionte, edges_f$basifamily)),
type = ifelse(name %in% edges_f$basifamily, "Basibionte family", "Epibionte species")
)
# criar grafo
g <- igraph::graph_from_data_frame(
d = edges_f %>% rename(from = epibionte, to = basifamily),
vertices = nodes,
directed = FALSE
)
ggraph(g, layout = "bipartite") +
geom_edge_link(aes(width = weight), alpha = 0.6) +
geom_node_point(aes(shape = type), size = 3) +
geom_node_text(aes(label = name), repel = TRUE,
size = 3,
fontface = ifelse(V(g)$type == "Epibionte species", "italic", "bold")) +
theme_void() +
labs(title = "Rede bipartida: Epibiontes (esp√©cies) √ó Basibiontes (fam√≠lias)")
#B) top N esp√©cies por fam√≠lia (recomendado)
topN <- 15
edges_f <- edges %>%
group_by(family) %>%
arrange(desc(weight), .by_group = TRUE) %>%
slice_head(n = topN) %>%
ungroup()
edges
edges_f <- edges %>%
group_by(basifamily) %>%
arrange(desc(weight), .by_group = TRUE) %>%
slice_head(n = topN) %>%
ungroup()
#3) Criar grafo e plotar (bipartido + labels)
library(igraph)
library(ggraph)
library(tibble)
g <- graph_from_data_frame(
d = edges_f %>% rename(from = species, to = family),
vertices = nodes,
directed = FALSE
)
edges_f
g <- graph_from_data_frame(
d = edges_f %>% rename(from = epibionte, to = family),
vertices = nodes,
directed = FALSE
)
