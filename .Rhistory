"Alta" = "#21908CFF",
"Muito Alta" = "gold")) +  # paleta inspirada no viridis
# Setas para variáveis
geom_segment(data = cor_todas,
aes(x = 0, y = 0, xend = PCo1 * 2, yend = PCo2 * 2,
color = tipo),
arrow = arrow(length = unit(0.2, "cm"))) +
# Labels das variáveis
geom_text_repel(data = cor_todas,
aes(x = PCo1 * 2, y = PCo2 * 2,
label = variavel, color = tipo),
size = 5) +
# Personalização
scale_color_manual(values = c("Atributos" = "black",
"Ambientais" = "red")) +
labs(
x = paste0("PCoA1 (", round(var_explicada[1], 2), "%)"),
y = paste0("PCoA2 (", round(var_explicada[2], 2), "%)"),
color = "Tipo de Variável"
) +
theme(
#panel.grid = element_blank(),
axis.text.y = element_text(angle = 90, hjust = 0.5), # Gira os números da latitude
panel.background = element_rect(fill = "white"),  # fundo branco
panel.border = element_rect(color = "gray", fill = NA),
legend.position = "top",  # legenda horizontal embaixo
legend.direction = "horizontal"
) +
coord_equal()+
annotate("text", x = -Inf, y = Inf, label = "(b)", hjust = -0.2, vjust = 1.2,
fontface = "bold", size = 8)
# dev.off()
}
analise_pcoa_gower_tec()
#filtrando os dados
tec_filt<-tecados[, c("CTH","DMH","H.margin","N.pattern","H.pattern","Temperatura","Salinidade" )]
# Preparação dos dados
tec_filt <- tec_filt %>%
mutate_if(is.character, as.factor)
funcionais_tec <- tec_filt[, c("CTH","DMH",
"H.margin","N.pattern","H.pattern")]
ambientais_tec <- tec_filt[, c("Temperatura","Salinidade")]
# daisy() lida automaticamente com variáveis mistas
dist_gower <- daisy(funcionais_tec, metric = "gower")
# Realizar PCoA
pcoa <- cmdscale(dist_gower, k = 2, eig = TRUE)
# Criar dataframe com scores da PCoA
scores_df <- data.frame(
PCo1 = pcoa$points[,1],
PCo2 = pcoa$points[,2],
Salinidade = ambientais_tec$Salinidade,
Temperatura = ambientais_tec$Temperatura
)
# Calcular correlações das variáveis com os eixos
# Para atributos funcionais
cor_func <- data.frame(
variavel = colnames(funcionais_tec),
tipo = "Atributos",
stringsAsFactors = FALSE
)
for(i in 1:ncol(funcionais_tec)) {
if(is.numeric(funcionais_tec[[i]])) {
cor_func$PCo1[i] <- cor(funcionais_tec[[i]], scores_df$PCo1, use = "complete.obs")
cor_func$PCo2[i] <- cor(funcionais_tec[[i]], scores_df$PCo2, use = "complete.obs")
} else {
# Para variáveis categóricas, usar análise de redundância
dummy <- model.matrix(~ funcionais_tec[[i]] - 1)
cor_func$PCo1[i] <- mean(cor(dummy, scores_df$PCo1))
cor_func$PCo2[i] <- mean(cor(dummy, scores_df$PCo2))
}
}
# Para variáveis ambientais
cor_amb <- data.frame(
variavel = colnames(ambientais_tec),
PCo1 = NA,
PCo2 = NA,
tipo = "Ambientais",
stringsAsFactors = FALSE
)
for(i in 1:ncol(ambientais_tec)) {
cor_amb$PCo1[i] <- cor(ambientais_tec[[i]], scores_df$PCo1, use = "complete.obs")
cor_amb$PCo2[i] <- cor(ambientais_tec[[i]], scores_df$PCo2, use = "complete.obs")
}
# Combinar correlações
cor_todas <- rbind(cor_func, cor_amb)
# Calcular variância explicada
var_explicada <- (pcoa$eig / sum(pcoa$eig)) * 100
#cortando a salinidade
scores_df$Estrato_Salinidade <- cut(scores_df$Salinidade, breaks = 3)
# Nomeando os estratos
scores_df$Estrato_Salinidade <- cut(scores_df$Salinidade,
breaks = 3,
labels = c( "Média", "Alta", "Muito Alta"))
ggplot() +
# Pontos das observações
geom_point(data = scores_df, aes(x = PCo1, y = PCo2, fill = Estrato_Salinidade),
shape = 21, size = 4, alpha = 0.6, color = "white") +
scale_fill_manual(values = c(
"Média" = "#3B528BFF",
"Alta" = "#21908CFF",
"Muito Alta" = "gold")) +  # paleta inspirada no viridis
# Setas para variáveis
geom_segment(data = cor_todas,
aes(x = 0, y = 0, xend = PCo1 * 2, yend = PCo2 * 2,
color = tipo),
arrow = arrow(length = unit(0.2, "cm"))) +
# Labels das variáveis
geom_text_repel(data = cor_todas,
aes(x = PCo1 * 2, y = PCo2 * 2,
label = variavel, color = tipo),
size = 5) +
# Personalização
scale_color_manual(values = c("Atributos" = "black",
"Ambientais" = "red")) +
labs(
x = paste0("PCoA1 (", round(var_explicada[1], 2), "%)"),
y = paste0("PCoA2 (", round(var_explicada[2], 2), "%)"),
color = "Tipo de Variável"
) +
theme(
#panel.grid = element_blank(),
axis.text.y = element_text(angle = 90, hjust = 0.5), # Gira os números da latitude
panel.background = element_rect(fill = "white"),  # fundo branco
panel.border = element_rect(color = "gray", fill = NA),
legend.position = "top",  # legenda horizontal embaixo
legend.direction = "horizontal"
) +
coord_equal()+
annotate("text", x = -Inf, y = Inf, label = "(b)", hjust = -0.2, vjust = 1.2,
fontface = "bold", size = 8)
# verificando envfit -----
# 10. Aplicar envfit
env <- envfit(scores_df[, c("PCo1", "PCo2")], cor_amb, permutations = 9999)
# verificando envfit -----
# 10. Aplicar envfit
env <- envfit(scores_df[, c("PCo1", "PCo2")], ambientais_tec, permutations = 9999)
# 11. Extrair vetores significativos (p < 0.05)
vetores_env <- as.data.frame(scores(env, display = "vectors"))
vetores_env$variavel <- rownames(vetores_env)
vetores_env$p_valor <- env$vectors$pvals
colnames(vetores_env)[1:2] <- c("Dim1", "Dim2")
vetores_env_sig <- vetores_env %>% filter(p_valor < 0.05)
vetores_env
View(vetores_env)
# salvando..
writexl::write_xlsx(list(
Autovalores = autovalores,
Scores_PCoA = scores_pcoa
), "C:/Users/Andreza/Documents/GitHub/ATRIBUTOS/PosDefesa/resultado_pcoa_tecados.xlsx")
# Autovalores da PCoA
autovalores <- data.frame(
Eixo = paste0("PCo", 1:length(pcoa$eig)),
Autovalor = as.numeric(pcoa$eig),
Variancia_Explicada = round((as.numeric(pcoa$eig) / sum(as.numeric(pcoa$eig))) * 100, 2)
)
autovalores
# salvando..
writexl::write_xlsx(list(
Autovalores = autovalores,
Scores_PCoA = scores_pcoa
), "C:/Users/Andreza/Documents/GitHub/ATRIBUTOS/PosDefesa/resultado_pcoa_tecados.xlsx")
# Coordenadas (scores das amostras nos eixos da PCoA)
scores_pcoa <- as.data.frame(pcoa$points)
colnames(scores_pcoa) <- c("PCo1", "PCo2")
pcoa_result$eig
pcoa$eig
# salvando..
writexl::write_xlsx(list(
Autovalores = autovalores,
Scores_PCoA = scores_pcoa
), "C:/Users/Andreza/Documents/GitHub/ATRIBUTOS/PosDefesa/resultado_pcoa_tecados.xlsx")
setwd("E:/GitHub/GPA-Beatriz/GPA-Beatriz-analises")
getwd()
# BblioteCAS----
library(readr)
library(dplyr)
library(ggplot2)
library(geobr)
library(ggspatial)
library(rnaturalearth)
library(sf)
library(gridExtra)
library(writexl)
library(tidyverse)
library(devtools)
library(rnaturalearthhires)
library(vegan)
library(dplyr)
library(raster)
library(reshape2)
library(extrafont)
df1<- readxl::read_xlsx("Data/COPIA-Database_epizoism_hydroids-bea.xlsx")
colnames(df)
colnames(df1)
familias_epi <- df1 %>%
count(EP_family, name = "frequencia") %>%   # conta por família
arrange(desc(frequencia))
familias_base <- df %>%
count(BS_Family, name = "frequencia") %>%   # conta por família
arrange(desc(frequencia))
generos_epi <- df1 %>%
count(EP_Genera, name = "frequencia") %>%   # conta por genero
arrange(desc(frequencia))
generos_base <- df1 %>%
count(BS_Genera, name = "frequencia") %>%   # conta por genero
arrange(desc(frequencia))
# BASE-SPP UNI
familias_base_especies <- df1 %>%
distinct(BS_family, Scientific_name_BS) %>%         # remove duplicatas da combinação
count(BS_Family, name = "n_especies") %>%   # conta quantas espécies únicas por família
arrange(desc(n_especies))
list_spp_base<-df1 %>%
distinct(Scientific_name_BS)
View(df1)
# BASE-SPP UNI
familias_base_especies <- df1 %>%
distinct(BS_Family, Scientific_name_BS) %>%         # remove duplicatas da combinação
count(BS_Family, name = "n_especies") %>%   # conta quantas espécies únicas por família
arrange(desc(n_especies))
list_spp_base<-df1 %>%
distinct(Scientific_name_BS)
View(familias_base_especies)
#escreve varias pastas do arquivo <3
writexl::write_xlsx(
list(
"Resumo Geral" = df,
"spp-fam-epi" = list_spp,
"num-spp-fam-epi"=familias_epi_especies,
"spp-fam-epi"=list_spp_base,
"num-spp-fam-base"=familias_base_especies,
),
path = "data/famílias_frequencias.xlsx"
)
familias_epi_especies <- df1 %>%
distinct(EP_family, Scientific_name_EP) %>%         # remove duplicatas da combinação
count(EP_family, name = "n_especies") %>%   # conta quantas espécies únicas por família
arrange(desc(n_especies))
list_spp<-df1 %>%
distinct(Scientific_name_EP)
#escreve varias pastas do arquivo <3
writexl::write_xlsx(
list(
"Resumo Geral" = df,
"spp-fam-epi" = list_spp,
"num-spp-fam-epi"=familias_epi_especies,
"spp-fam-epi"=list_spp_base,
"num-spp-fam-base"=familias_base_especies,
),
path = "data/famílias_frequencias.xlsx"
)
writexl::write_xlsx(
list(
"Resumo Geral" = df,
"spp-fam-epi" = list_spp,
"num-spp-fam-epi"=familias_epi_especies,
"spp-fam-epi"=list_spp_base,
"num-spp-fam-base"=familias_base_especies
),
path = "data/famílias_frequencias.xlsx"
)
# BASE-SPP UNI
familias_base_especies <- df1 %>%
distinct(BS_Family, Scientific_name_BS) %>%         # remove duplicatas da combinação
count(BS_Family, name = "n_especies") %>%   # conta quantas espécies únicas por família
arrange(desc(n_especies))
list_spp_base<-df1 %>%
distinct(Scientific_name_BS)
#escreve varias pastas do arquivo <3
writexl::write_xlsx(
list(
"Resumo Geral" = df,
"spp-fam-epi" = list_spp,
"num-spp-fam-epi"=familias_epi_especies,
"spp-fam-epi"=list_spp_base,
"num-spp-fam-base"=familias_base_especies
),
path = "data/famílias_frequencias.xlsx"
)
View(familias_epi)
#escreve varias pastas do arquivo <3
writexl::write_xlsx(
list(
"Resumo Geral" = df,
"spp-fam-epi" = list_spp,
"num-spp-fam-epi"=familias_epi_especies,
"spp-fam-base"=list_spp_base,
"num-spp-fam-base"=familias_base_especies
),
path = "data/famílias_frequencias.xlsx"
)
writexl::write_xlsx(
list(
"Resumo Geral" = df,
"spp-fam-epi" = list_spp,
"num-spp-fam-epi"=familias_epi_especies,
"spp-fam-base"=list_spp_base,
"num-spp-fam-base"=familias_base_especies
),
path = "data/famílias_frequencias.xlsx"
)
str(df)
str(list_spp)
str(familias_epi_especies)
str(list_spp_base)
str(familias_base_especies)
epi  <- familias_epi  %>%
rename(family = EP_family, n_epi = frequencia)  # se já for EP_family, use rename(family = EP_family)
base <- familias_base %>%
rename(family = BS_Family,  n_base = frequencia)
df <- full_join(epi, base, by = "family") %>%
mutate(across(c(n_epi, n_base), ~replace_na(.x, 0)))
familias_epi <- df1 %>%
count(EP_family, name = "frequencia") %>%   # conta por família
arrange(desc(frequencia))
familias_base <- df %>%
count(BS_Family, name = "frequencia") %>%   # conta por família
arrange(desc(frequencia))
generos_epi <- df1 %>%
count(EP_Genera, name = "frequencia") %>%   # conta por genero
arrange(desc(frequencia))
generos_base <- df1 %>%
count(BS_Genera, name = "frequencia") %>%   # conta por genero
arrange(desc(frequencia))
windows(12,9)
library(dplyr)
library(tidyr)
library(forcats)
library(ggplot2)
library(scales)
epi  <- familias_epi  %>%
rename(family = EP_family, n_epi = frequencia)  # se já for EP_family, use rename(family = EP_family)
base <- familias_base %>%
rename(family = BS_Family,  n_base = frequencia)
df <- full_join(epi, base, by = "family") %>%
mutate(across(c(n_epi, n_base), ~replace_na(.x, 0)))
# (opcional) ordenar por total absoluto
df <- df %>%
mutate(total = n_epi + n_base,
family = fct_reorder(family, total, .desc = TRUE))
epi  <- familias_epi  %>%
rename(family = EP_family, n_epi = frequencia)  # se já for EP_family, use rename(family = EP_family)
base <- familias_base %>%
rename(family = BS_Family,  n_base = frequencia)
familias_epi <- df1 %>%
count(EP_family, name = "frequencia") %>%   # conta por família
arrange(desc(frequencia))
familias_base <- df %>%
count(BS_Family, name = "frequencia") %>%   # conta por família
arrange(desc(frequencia))
generos_epi <- df1 %>%
count(EP_Genera, name = "frequencia") %>%   # conta por genero
arrange(desc(frequencia))
generos_base <- df1 %>%
count(BS_Genera, name = "frequencia") %>%   # conta por genero
arrange(desc(frequencia))
windows(12,9)
epi  <- familias_epi  %>%
rename(family = EP_family, n_epi = frequencia)  # se já for EP_family, use rename(family = EP_family)
base <- familias_base %>%
rename(family = BS_Family,  n_base = frequencia)
df <- full_join(epi, base, by = "family") %>%
mutate(across(c(n_epi, n_base), ~replace_na(.x, 0)))
epi  <- familias_epi  %>%
rename(family = EP_family, n_epi = frequencia)  # se já for EP_family, use rename(family = EP_family)
base <- familias_base %>%
rename(family = BS_Family,  n_base = frequencia)
familias_base <- df1 %>%
count(BS_Family, name = "frequencia") %>%   # conta por família
arrange(desc(frequencia))
generos_epi <- df1 %>%
count(EP_Genera, name = "frequencia") %>%   # conta por genero
arrange(desc(frequencia))
generos_base <- df1 %>%
count(BS_Genera, name = "frequencia") %>%   # conta por genero
arrange(desc(frequencia))
windows(12,9)
epi  <- familias_epi  %>%
rename(family = EP_family, n_epi = frequencia)  # se já for EP_family, use rename(family = EP_family)
base <- familias_base %>%
rename(family = BS_Family,  n_base = frequencia)
df <- full_join(epi, base, by = "family") %>%
mutate(across(c(n_epi, n_base), ~replace_na(.x, 0)))
# (opcional) ordenar por total absoluto
df <- df %>%
mutate(total = n_epi + n_base,
family = fct_reorder(family, total, .desc = TRUE))
writexl::write_xlsx(
list(
"Resumo Geral" = df,
"spp-fam-epi" = list_spp,
"num-spp-fam-epi"=familias_epi_especies,
"spp-fam-base"=list_spp_base,
"num-spp-fam-base"=familias_base_especies
),
path = "data/famílias_frequencias.xlsx"
)
View(df1)
generos_base_especies <- df1 %>%
distinct(BS_Genera, Scientific_name_BS) %>%         # remove duplicatas da combinação
count(BS_Genera, name = "n_especies") %>%   # conta quantas espécies únicas por família
arrange(desc(n_especies))
list_spp_gen_base<-df1 %>%
distinct(Scientific_name_BS)
generos_base_especies
list_spp_gen_base
generos_epi_especies <- df1 %>%
distinct(EP_Genera, Scientific_name_BS) %>%         # remove duplicatas da combinação
count(EP_Genera, name = "n_especies") %>%   # conta quantas espécies únicas por família
arrange(desc(n_especies))
generos_epi_especies
View(generos_epi)
generos_epi_especies <- df1 %>%
distinct(EP_Genera, Scientific_name_EP) %>%         # remove duplicatas da combinação
count(EP_Genera, name = "n_especies") %>%   # conta quantas espécies únicas por família
arrange(desc(n_especies))
generos_epi_especies
View(base)
View(df1)
View(familias_epi)
View(generos_epi)
View(generos_epi_especies)
df1<- readxl::read_xlsx("Data/COPIA-Database_epizoism_hydroids-bea.xlsx")
familias_epi_especies <- df1 %>%
distinct(EP_family, Scientific_name_EP) %>%         # remove duplicatas da combinação
count(EP_family, name = "n_especies") %>%   # conta quantas espécies únicas por família
arrange(desc(n_especies))
list_spp<-df1 %>%
distinct(Scientific_name_EP)
# BASE-SPP UNI
familias_base_especies <- df1 %>%
distinct(BS_Family, Scientific_name_BS) %>%         # remove duplicatas da combinação
count(BS_Family, name = "n_especies") %>%   # conta quantas espécies únicas por família
arrange(desc(n_especies))
list_spp_base<-df1 %>%
distinct(Scientific_name_BS)
generos_epi <- df1 %>%
count(EP_Genera, name = "frequencia") %>%   # conta por genero
arrange(desc(frequencia))
generos_epi
generos_base <- df1 %>%
count(BS_Genera, name = "frequencia") %>%   # conta por genero
arrange(desc(frequencia))
generos_base_especies <- df1 %>%
distinct(BS_Genera, Scientific_name_BS) %>%         # remove duplicatas da combinação
count(BS_Genera, name = "n_especies") %>%   # conta quantas espécies únicas por família
arrange(desc(n_especies))
generos_epi_especies <- df1 %>%
distinct(EP_Genera, Scientific_name_EP) %>%         # remove duplicatas da combinação
count(EP_Genera, name = "n_especies") %>%   # conta quantas espécies únicas por família
arrange(desc(n_especies))
generos_epi_especies
familias_epi <- df1 %>%
count(EP_family, name = "frequencia") %>%   # conta por família
arrange(desc(frequencia))
familias_base <- df1 %>%
count(BS_Family, name = "frequencia") %>%   # conta por família
arrange(desc(frequencia))
generos_epi <- df1 %>%
count(EP_Genera, name = "frequencia") %>%   # conta por genero
arrange(desc(frequencia))
generos_base <- df1 %>%
count(BS_Genera, name = "frequencia") %>%   # conta por genero
arrange(desc(frequencia))
epi  <- familias_epi  %>%
rename(family = EP_family, n_epi = frequencia)  # se já for EP_family, use rename(family = EP_family)
base <- familias_base %>%
rename(family = BS_Family,  n_base = frequencia)
df <- full_join(epi, base, by = "family") %>%
mutate(across(c(n_epi, n_base), ~replace_na(.x, 0)))
# (opcional) ordenar por total absoluto
df <- df %>%
mutate(total = n_epi + n_base,
family = fct_reorder(family, total, .desc = TRUE))
#escreve varias pastas do arquivo <3
writexl::write_xlsx(
list(
"Resumo Geral" = df,
"spp-fam-epi" = list_spp,
"num-spp-fam-epi"=familias_epi_especies,
"spp-fam-base"=list_spp_base,
"num-spp-fam-base"=familias_base_especies,
"spp-gen-epi"=  generos_epi_especies,
"spp-gen-base"=  generos_base_especies
),
path = "data/famílias_frequencias.xlsx"
)
#escreve varias pastas do arquivo <3
writexl::write_xlsx(
list(
"Resumo Geral" = df,
"spp-fam-epi" = list_spp,
"num-spp-fam-epi"=familias_epi_especies,
"spp-fam-base"=list_spp_base,
"num-spp-fam-base"=familias_base_especies,
"spp-gen-epi"=  generos_epi_especies,
"spp-gen-base"=  generos_base_especies
),
path = "data/fam-gen-freq-contg.xlsx"
)
#escreve varias pastas do arquivo <3
writexl::write_xlsx(
list(
"Resumo-frequencia-fam" = df,
"spp-fam-epi" = list_spp,
"num-spp-fam-epi"=familias_epi_especies,
"spp-fam-base"=list_spp_base,
"num-spp-fam-base"=familias_base_especies,
"spp-gen-epi"=  generos_epi_especies,
"spp-gen-base"=  generos_base_especies
),
path = "data/fam-gen-freq-contg.xlsx"
)
