inherit.aes = FALSE,
vjust = 0.5,
size = 3.8,
fontface = "bold",
color = "gray10"
)+
# eixo em porcentagem (mostrando sempre valor positivo no rótulo)
scale_y_continuous(labels = function(v) paste0(abs(v), "%")) +
scale_fill_manual(values = c("Epibiontes"="darkblue","Basebiontes"="darkorange"), name=NULL) +
coord_flip(clip = "off") +
labs(y = "porcentagem (%)", x = "Family", fill = "Regions", color = "Regions") +
theme_minimal() +
theme(
panel.grid.major.x = element_blank(),
axis.text.y = element_blank(), axis.title.y = element_blank(),
plot.margin = margin(10, 40, 10, 40),
legend.position = "bottom",
legend.direction = "horizontal"
)
g
g <- ggplot(df_long, aes(x = family, y = percentual)) +
# barras agora representam porcentagem
geom_col(aes(fill = grupo), width = 0.75, color = "white", linewidth = 0.2) +
# --------- RÓTULOS DENTRO DAS BARRAS (positivas) ---------
geom_text(
data = subset(df_long, percentual > 0 & abs(percentual) >= 1.5),
inherit.aes = FALSE,
aes(
x = family,
y = percentual / 2,
label = paste0(n, " (", round(percentual, 1), "%)")
),
hjust = 0.5, vjust = 0.5,
size = 4.2, color = "white", fontface = "bold"
)+
# --------- RÓTULOS DENTRO DAS BARRAS (negativas) ---------
geom_text(
data = subset(df_long, percentual < 0 & abs(percentual) >= 1.5),
inherit.aes = FALSE,
aes(
x = family,
y = percentual / 2,
label = paste0(abs(n), " (", round(abs(percentual), 1), "%)")
),
hjust = 0.5, vjust = 0.5,
size = 4.2, color = "white", fontface = "bold"
)+
# --------- NOMES DAS FAMÍLIAS (lado direito) ---------
geom_text(
data = labs_right,
aes(x = family, y = y_pos, label = family, hjust = hjust),
inherit.aes = FALSE,
vjust = 0.5,
size = 3.8,
fontface = "bold",
color = "gray10"
)+
# eixo em porcentagem (mostrando sempre valor positivo no rótulo)
scale_y_continuous(labels = function(v) paste0(abs(v), "%")) +
scale_fill_manual(values = c("Epibiontes"="darkblue","Basebiontes"="darkorange"), name=NULL) +
coord_flip(clip = "off") +
labs(y = "porcentagem (%)", x = "Family", fill = "Regions", color = "Regions") +
theme_minimal() +
theme(
panel.grid.major.x = element_blank(),
axis.text.y = element_blank(), axis.title.y = element_blank(),
plot.margin = margin(10, 40, 10, 40),
legend.position = "bottom",
legend.direction = "horizontal"
)
g
View(df_long)
totais <- df_long %>%
group_by(grupo) %>%
summarise(total_abs = sum(abs(n)), .groups = "drop")
totais
install.packages("treemapify")
library(treemapify)
library(ggplot2)
ggplot(df_long, aes(
area = abs(n),            # tamanho proporcional ao número de indivíduos
fill = grupo,             # cor por grupo
label = paste0(family, "\n", abs(n), " (", round(abs(percentual), 1), "%)")
)) +
geom_treemap(color = "white") +
geom_treemap_text(
place = "centre",
grow = TRUE,
reflow = TRUE,
color = "white",
fontface = "bold"
) +
scale_fill_manual(values = c("Epibiontes" = "darkblue", "Basebiontes" = "darkorange")) +
labs(fill = "Grupo") +
theme_minimal()
library(treemapify)
library(ggplot2)
library(patchwork)
# Separar os dados
df_epi <- df_long %>% filter(grupo == "Epibiontes", abs(percentual) >= 1.5)
df_base <- df_long %>% filter(grupo == "Basebiontes", abs(percentual) >= 1.5)
# Treemap dos Epibiontes
g_epi <- ggplot(df_epi, aes(
area = abs(n),
fill = family,  # usa family pra cor única por família
label = paste0(family, "\n", abs(n), " (", round(abs(percentual), 1), "%)")
)) +
geom_treemap(color = "white") +
geom_treemap_text(
place = "centre", grow = TRUE, reflow = TRUE,
color = "white", fontface = "bold", size = 10
) +
scale_fill_viridis_d(option = "D") +
labs(title = "Epibiontes") +
theme_minimal() +
theme(legend.position = "none")
# Treemap dos Basebiontes
g_base <- ggplot(df_base, aes(
area = abs(n),
fill = family,
label = paste0(family, "\n", abs(n), " (", round(abs(percentual), 1), "%)")
)) +
geom_treemap(color = "white") +
geom_treemap_text(
place = "centre", grow = TRUE, reflow = TRUE,
color = "white", fontface = "bold", size = 10
) +
scale_fill_viridis_d(option = "C") +
labs(title = "Basebiontes") +
theme_minimal() +
theme(legend.position = "none")
g_epi + g_base + plot_layout(ncol = 2)
# gerar paleta (pode ajustar n de cores conforme necessário)
palette_fam <- setNames(
colorRampPalette(brewer.pal(9, "Set3"))(length(familias_unicas)),
familias_unicas
)
# todas as famílias envolvidas
familias_unicas <- unique(df_long$family)
# gerar paleta (pode ajustar n de cores conforme necessário)
palette_fam <- setNames(
colorRampPalette(brewer.pal(9, "Set3"))(length(familias_unicas)),
familias_unicas
)
# Separar os dados
df_epi <- df_long %>% filter(grupo == "Epibiontes", abs(percentual) >= 1.5)
df_base <- df_long %>% filter(grupo == "Basebiontes", abs(percentual) >= 1.5)
# 2️⃣ Gerar os treemaps com fill = family e scale_fill_manual(values = palette_fam)
# Epibiontes
g_epi <- ggplot(df_epi, aes(
area = abs(n),
fill = family,
label = paste0(family, "\n", abs(n), " (", round(abs(percentual), 1), "%)")
)) +
geom_treemap(color = "white") +
geom_treemap_text(
place = "centre", grow = TRUE, reflow = TRUE,
color = "white", fontface = "bold", size = 10
) +
scale_fill_manual(values = palette_fam) +
labs(title = "Epibiontes") +
theme_minimal() +
theme(legend.position = "none")
# Basebiontes
g_base <- ggplot(df_base, aes(
area = abs(n),
fill = family,
label = paste0(family, "\n", abs(n), " (", round(abs(percentual), 1), "%)")
)) +
geom_treemap(color = "white") +
geom_treemap_text(
place = "centre", grow = TRUE, reflow = TRUE,
color = "white", fontface = "bold", size = 10
) +
scale_fill_manual(values = palette_fam) +
labs(title = "Basebiontes") +
theme_minimal() +
theme(legend.position = "none")
# gerar paleta (pode ajustar n de cores conforme necessário)
palette_fam <- setNames(
colorRampPalette(brewer.pal(9, "Set3"))(length(familias_unicas)),
familias_unicas
)
# 1️⃣ Definir uma paleta única por família
library(RColorBrewer)
# todas as famílias envolvidas
familias_unicas <- unique(df_long$family)
# gerar paleta (pode ajustar n de cores conforme necessário)
palette_fam <- setNames(
colorRampPalette(brewer.pal(9, "Set3"))(length(familias_unicas)),
familias_unicas
)
# Separar os dados
df_epi <- df_long %>% filter(grupo == "Epibiontes", abs(percentual) >= 1.5)
df_base <- df_long %>% filter(grupo == "Basebiontes", abs(percentual) >= 1.5)
# 2️⃣ Gerar os treemaps com fill = family e scale_fill_manual(values = palette_fam)
# Epibiontes
g_epi <- ggplot(df_epi, aes(
area = abs(n),
fill = family,
label = paste0(family, "\n", abs(n), " (", round(abs(percentual), 1), "%)")
)) +
geom_treemap(color = "white") +
geom_treemap_text(
place = "centre", grow = TRUE, reflow = TRUE,
color = "white", fontface = "bold", size = 10
) +
scale_fill_manual(values = palette_fam) +
labs(title = "Epibiontes") +
theme_minimal() +
theme(legend.position = "none")
# Basebiontes
g_base <- ggplot(df_base, aes(
area = abs(n),
fill = family,
label = paste0(family, "\n", abs(n), " (", round(abs(percentual), 1), "%)")
)) +
geom_treemap(color = "white") +
geom_treemap_text(
place = "centre", grow = TRUE, reflow = TRUE,
color = "white", fontface = "bold", size = 10
) +
scale_fill_manual(values = palette_fam) +
labs(title = "Basebiontes") +
theme_minimal() +
theme(legend.position = "none")
#3️⃣ Juntar os dois:
g_epi + g_base + plot_layout(ncol = 2)
# gerar paleta (pode ajustar n de cores conforme necessário)
palette_fam <- setNames(
colorRampPalette(brewer.pal(9, "Set1"))(length(familias_unicas)),
familias_unicas
)
# Separar os dados
df_epi <- df_long %>% filter(grupo == "Epibiontes", abs(percentual) >= 1.5)
df_base <- df_long %>% filter(grupo == "Basebiontes", abs(percentual) >= 1.5)
# 2️⃣ Gerar os treemaps com fill = family e scale_fill_manual(values = palette_fam)
# Epibiontes
g_epi <- ggplot(df_epi, aes(
area = abs(n),
fill = family,
label = paste0(family, "\n", abs(n), " (", round(abs(percentual), 1), "%)")
)) +
geom_treemap(color = "white") +
geom_treemap_text(
place = "centre", grow = TRUE, reflow = TRUE,
color = "white", fontface = "bold", size = 10
) +
scale_fill_manual(values = palette_fam) +
labs(title = "Epibiontes") +
theme_minimal() +
theme(legend.position = "none")
# Basebiontes
g_base <- ggplot(df_base, aes(
area = abs(n),
fill = family,
label = paste0(family, "\n", abs(n), " (", round(abs(percentual), 1), "%)")
)) +
geom_treemap(color = "white") +
geom_treemap_text(
place = "centre", grow = TRUE, reflow = TRUE,
color = "white", fontface = "bold", size = 10
) +
scale_fill_manual(values = palette_fam) +
labs(title = "Basebiontes") +
theme_minimal() +
theme(legend.position = "none")
#3️⃣ Juntar os dois:
g_epi + g_base + plot_layout(ncol = 2)
source("E:/GitHub/GPA-Beatriz/GPA-Beatriz-analises/Scripts/treemap.R")
#grafico de barra paralelo - frequencia - bea
#1.10.2025
setwd("E:/GitHub/GPA-Beatriz/GPA-Beatriz-analises")
getwd()
# BblioteCAS----
library(readr)
library(dplyr)
library(ggplot2)
library(geobr)
library(ggspatial)
library(rnaturalearth)
library(sf)
library(gridExtra)
library(writexl)
library(tidyverse)
library(devtools)
library(rnaturalearthhires)
library(vegan)
library(dplyr)
library(raster)
library(reshape2)
library(extrafont)
df1<- readxl::read_xlsx("Data/COPIA-Database_epizoism_hydroids-bea.xlsx")
colnames(df)
EP-family
#install.packages("treemapify")
library(treemapify)
library(ggplot2)
ggplot(df_long, aes(
area = abs(n),            # tamanho proporcional ao número de indivíduos
fill = grupo,             # cor por grupo
label = paste0(family, "\n", abs(n), " (", round(abs(percentual), 1), "%)")
)) +
geom_treemap(color = "white") +
geom_treemap_text(
place = "centre",
grow = TRUE,
reflow = TRUE,
color = "white",
fontface = "bold"
) +
scale_fill_manual(values = c("Epibiontes" = "darkblue", "Basebiontes" = "darkorange")) +
labs(fill = "Grupo") +
theme_minimal()
library(treemapify)
library(ggplot2)
library(patchwork)
# 1️⃣ Definir uma paleta única por família
library(RColorBrewer)
# todas as famílias envolvidas
familias_unicas <- unique(df_long$family)
# gerar paleta (pode ajustar n de cores conforme necessário)
palette_fam <- setNames(
colorRampPalette(brewer.pal(9, "Set1"))(length(familias_unicas)),
familias_unicas
)
# Separar os dados
df_epi <- df_long %>% filter(grupo == "Epibiontes", abs(percentual) >= 1.5)
df_base <- df_long %>% filter(grupo == "Basebiontes", abs(percentual) >= 1.5)
# 2️⃣ Gerar os treemaps com fill = family e scale_fill_manual(values = palette_fam)
# Epibiontes
g_epi <- ggplot(df_epi, aes(
area = abs(n),
fill = family,
label = paste0(family, "\n", abs(n), " (", round(abs(percentual), 1), "%)")
)) +
geom_treemap(color = "white") +
geom_treemap_text(
place = "centre", grow = TRUE, reflow = TRUE,
color = "white", fontface = "bold", size = 10
) +
scale_fill_manual(values = palette_fam) +
labs(title = "Epibiontes") +
theme_minimal() +
theme(legend.position = "none")
# Basebiontes
g_base <- ggplot(df_base, aes(
area = abs(n),
fill = family,
label = paste0(family, "\n", abs(n), " (", round(abs(percentual), 1), "%)")
)) +
geom_treemap(color = "white") +
geom_treemap_text(
place = "centre", grow = TRUE, reflow = TRUE,
color = "white", fontface = "bold", size = 10
) +
scale_fill_manual(values = palette_fam) +
labs(title = "Basebiontes") +
theme_minimal() +
theme(legend.position = "none")
#3️⃣ Juntar os dois:
plots_tree<- g_epi + g_base + plot_layout(ncol = 2)
plots_tree
ggsave("Plots/treemap.png",
plot = plots_tree, width = 14, height = 10, dpi = 300, units = "in")
ggsave("Plots/treemap.png",
plot = plots_tree, width = 14, height = 10, dpi = 600, units = "in")
# gerar paleta (pode ajustar n de cores conforme necessário)
palette_fam <- setNames(
colorRampPalette(brewer.pal(9, "Set2"))(length(familias_unicas)),
familias_unicas
)
# Basebiontes
g_base <- ggplot(df_base, aes(
area = abs(n),
fill = family,
label = paste0(family, "\n", abs(n), " (", round(abs(percentual), 1), "%)")
)) +
geom_treemap(color = "white") +
geom_treemap_text(
place = "centre", grow = TRUE, reflow = TRUE,
color = "white", fontface = "bold", size = 10
) +
scale_fill_manual(values = palette_fam) +
labs(title = "Basebiontes") +
theme_minimal() +
theme(legend.position = "none")
# 2️⃣ Gerar os treemaps com fill = family e scale_fill_manual(values = palette_fam)
# Epibiontes
g_epi <- ggplot(df_epi, aes(
area = abs(n),
fill = family,
label = paste0(family, "\n", abs(n), " (", round(abs(percentual), 1), "%)")
)) +
geom_treemap(color = "white") +
geom_treemap_text(
place = "centre", grow = TRUE, reflow = TRUE,
color = "white", fontface = "bold", size = 10
) +
scale_fill_manual(values = palette_fam) +
labs(title = "Epibiontes") +
theme_minimal() +
theme(legend.position = "none")
#3️⃣ Juntar os dois:
plots_tree<- g_epi + g_base + plot_layout(ncol = 2)
plots_tree
# gerar paleta (pode ajustar n de cores conforme necessário)
palette_fam <- setNames(
colorRampPalette(brewer.pal(9, "Set4"))(length(familias_unicas)),
familias_unicas
)
# gerar paleta (pode ajustar n de cores conforme necessário)
palette_fam <- setNames(
colorRampPalette(brewer.pal(9, "Set5"))(length(familias_unicas)),
familias_unicas
)
# gerar paleta (pode ajustar n de cores conforme necessário)
palette_fam <- setNames(
colorRampPalette(brewer.pal(9, "Set1"))(length(familias_unicas)),
familias_unicas
)
# 2️⃣ Gerar os treemaps com fill = family e scale_fill_manual(values = palette_fam)
# Epibiontes
g_epi <- ggplot(df_epi, aes(
area = abs(n),
fill = family,
label = paste0(family, "\n", abs(n), " (", round(abs(percentual), 1), "%)")
)) +
geom_treemap(color = "white") +
geom_treemap_text(
place = "centre", grow = TRUE, reflow = TRUE,
color = "white", fontface = "bold", size = 10
) +
scale_fill_manual(values = palette_fam) +
labs(title = "Epibiontes") +
theme_minimal() +
theme(legend.position = "none")
# Basebiontes
g_base <- ggplot(df_base, aes(
area = abs(n),
fill = family,
label = paste0(family, "\n", abs(n), " (", round(abs(percentual), 1), "%)")
)) +
geom_treemap(color = "white") +
geom_treemap_text(
place = "centre", grow = TRUE, reflow = TRUE,
color = "white", fontface = "bold", size = 10
) +
scale_fill_manual(values = palette_fam) +
labs(title = "Basebiontes") +
theme_minimal() +
theme(legend.position = "none")
#3️⃣ Juntar os dois:
plots_tree<- g_epi + g_base + plot_layout(ncol = 2)
plots_tree
ggsave("Plots/treemap.png",
plot = plots_tree, width = 14, height = 8, dpi = 600, units = "in")
ggsave("Plots/espelhado.png",
plot = g, width = 14, height = 8, dpi = 600, units = "in")
g <- ggplot(df_long, aes(x = family, y = percentual)) +
# barras agora representam porcentagem
geom_col(aes(fill = grupo), width = 0.75, color = "white", linewidth = 0.2) +
# --------- RÓTULOS DENTRO DAS BARRAS (positivas) ---------
geom_text(
data = subset(df_long, percentual > 0 & abs(percentual) >= 1.5),
inherit.aes = FALSE,
aes(
x = family,
y = percentual / 2,
label = paste0(n, " (", round(percentual, 1), "%)")
),
hjust = 0.5, vjust = 0.5,
size = 4.2, color = "white", fontface = "bold"
)+
# --------- RÓTULOS DENTRO DAS BARRAS (negativas) ---------
geom_text(
data = subset(df_long, percentual < 0 & abs(percentual) >= 1.5),
inherit.aes = FALSE,
aes(
x = family,
y = percentual / 2,
label = paste0(abs(n), " (", round(abs(percentual), 1), "%)")
),
hjust = 0.5, vjust = 0.5,
size = 4.2, color = "white", fontface = "bold"
)+
# --------- NOMES DAS FAMÍLIAS (lado direito) ---------
geom_text(
data = labs_right,
aes(x = family, y = y_pos, label = family, hjust = hjust),
inherit.aes = FALSE,
vjust = 0.5,
size = 3.8,
fontface = "bold",
color = "gray10"
)+
# eixo em porcentagem (mostrando sempre valor positivo no rótulo)
scale_y_continuous(labels = function(v) paste0(abs(v), "%")) +
scale_fill_manual(values = c("Epibiontes"="darkblue","Basebiontes"="darkorange"), name=NULL) +
coord_flip(clip = "off") +
labs(y = "porcentagem (%)", x = "Family", fill = "Regions", color = "Regions") +
theme_minimal() +
theme(
#panel.grid.major.x = element_blank(),
axis.text.y = element_blank(), axis.title.y = element_blank(),
plot.margin = margin(10, 40, 10, 40),
legend.position = "bottom",
legend.direction = "horizontal"
)
g
ggsave("Plots/espelhado.png",
plot = g, width = 14, height = 8, dpi = 600, units = "in")
